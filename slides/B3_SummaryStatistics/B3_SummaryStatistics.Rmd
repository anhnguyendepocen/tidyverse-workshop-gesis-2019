---
title: "Summary Statistics"
subtitle: "First inspections - What can we tell about the data?"
author: "Johannes Breuer<br />Thomas Ebel<br />Stefan MÃ¼ller"
date: "2018-05-16"
location: "GESIS, Mannheim, Germany"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: ["default", "default-fonts", "../footer-header.css", "../mycss.css"]
    nature:
      highlightStyle: "github"
      highlightLines: true
      countIncrementalSlides: false
---
layout: true

```{r setup, include=FALSE}
if (!require(knitr)) install.packages("knitr")
if (!require(rmarkdown)) install.packages("rmarkdown")
if (!require(tidyverse)) install.packages("tidyverse")
if (!require(datasauRus)) install.packages("datasauRus")
library("knitr")
library("rmarkdown")
library("tidyverse")
library("datasauRus")
options(htmltools.dir.version = FALSE)

opts_chunk$set(echo = FALSE, fig.align = "center")#
set.seed(123)
```

<div class="my-footer">
  <div style="float: left;"><span>`r gsub("<br />", " & ", gsub("<br /><br />|<a.+$", "", metadata$author))`</span></div>
  <div style="float: right;"><span>`r metadata$location`, `r metadata$date`</span></div>
  <div style="text-align: center;"><span>`r gsub(".+<br />", " ", metadata$title)`</span></div>
</div>

---

```{r, include=FALSE, warning=FALSE, error=FALSE}
# devtools::install_github("DavZim/colorTable")
library(colorTable)

# define some colors for later
green <- "#a6d96a"
blue  <- "#74add1"
yellow <- "#f4e842"
```
class: center, middle

<h1>Demystifing unknown knowns</h1>
<h2>What do we know, what don't we know and why do we care?</h2>

---

<h2>Untangling data is hard</h2>
Humans looking at raw numbers have a really hard time at understanding them.  
For example, it's almost impossible to say which of those 2 vectors has more variance, or the lower mean, just by looking at them.

```{r echo=FALSE, results='markup'}
x <- sample(x = 18:65, size = 10, replace = TRUE)
y <- sample(x = 20:60, size = 10, replace = TRUE)
untangling <- tibble(
  x,
  y
)
(x)
(y)
```

--

```{r echo=TRUE}
options(pillar.sigfig = 5)
untangling %>% summarize(mean_x = mean(x), mean_y = mean(y),
                         var_x = sd(x)^2, var_y = sd(y)^2)
```

In the real world, vectors are also too long to conveniently look at.

---

To make sense of data ... we need summarizing functions that produce singular values that give us an understanding of
* location (e.g. the mean),
* spread (e.g. standard deviation),
* shape of distribution (e.g. skewness) and
* relations between variables (e.g. correlation coefficients)

---

We assume all know the basics of summary statistics.  
So instead of repeating that let's see respective Tidyverse code.

--

Dataset is from gapminder.  

Income per person (fixed 2000 US$) for 275 countries for the years 1960-2011.

"Gross Domestic Product per capita in constant 2000 US$. The inflation but not the differences in the cost of living between countries has been taken into account."

```{r echo=TRUE}
capita <- readxl::read_excel(
  path = "./data/GDPpercapitaconstant2000US.xlsx", sheet = "Data",
  col_names = TRUE)
```
---

A first glimpse.
```{r}
capita %>% rename(country = 1) %>% glimpse
```


---
Let's start by reducing the data to 3 countries and converting it to long format.
```{r echo=TRUE}
capita %>%
  rename(country = 1) %>%
  filter(country %in% 
           c("Germany", "United Kingdom", "United States")) %>%
  gather(2:53, key = "year", value = "income") %>%
  arrange(country, year) %>%
  tail
```

--

Showing the tail because Germany has missings up to and including 1969.

```{r echo=FALSE}
capita_long <- capita %>%
  rename(country = 1) %>%
  filter(country %in% 
           c("Germany", "United Kingdom", "United States")) %>%
  gather(2:53, key = "year", value = "income") %>%
  arrange(country, year)
```

---

<h2>Summary statistics</h2>

```{r echo=TRUE}
capita_long %>%
  mutate(change = (income / lag(income) - 1) * 100) %>%
  group_by(country) %>%
  summarise(n = n(), min_inc = min(income, na.rm = TRUE),
            max_inc = max(income, na.rm = TRUE), 
            diff = max_inc - min_inc, has_na = any(is.na(income)),
            max_change = max(change, na.rm = TRUE))
```

'change' is change in percent to previous year

---

```{r echo=TRUE}
capita_long %>%
  mutate(change = (income / lag(income) - 1) * 100) %>%
  filter(change > 5) 
  # %>% group_by(country) %>%
  # filter(change == max(change, na.rm = TRUE))
```

--

The out-commented lines show that we could use 'group_by' to just see the year in which each country's gdp increased the strongest. Even if we do not care about (other) summary statistics at all.

---

<h2>But, beware: Summary statistics can also be misleading!</h2>
![](img/pity_the_fool.jpg)

... who takes summary statistics as the complete picture", Mr. T?  
Well said!

---

Beautifully illustrated by the 'datasauRus' package, summary statistics can also mislead you about the structure of a dataset/variable.  

--

For example, with a (Pearson's) correlation coefficient between two variables close to 0 we often immediately think of a relation like this:

```{r}
datasauRus::datasaurus_dozen %>% 
  filter(dataset == "h_lines") %>% 
  ggplot(aes(x = x, y = y)) + geom_point() + theme_void()
```

---

**But**, datasauRus proves to us that various different relations with the same summary statistics are possible.

This one here has **the same correlation coefficient (-0.06, Pearson's)**.
```{r}
datasauRus::datasaurus_dozen %>% 
  filter(dataset == "slant_up") %>% 
  ggplot(aes(x = x, y = y)) + geom_point() + theme_void()
```
---

As does this one (again, -0.06):
```{r}
datasauRus::datasaurus_dozen %>% 
  filter(dataset == "dino") %>% 
  ggplot(aes(x = x, y = y)) + geom_point() + theme_void()
```

---
In fact, all of these 13 datasets have the same means, standard deviations, and Pearson's correlation coefficients.
```{r}
ggplot(datasaurus_dozen, aes(x=x, y=y, colour=dataset))+
geom_point()+
theme_void()+
theme(legend.position = "none")+
facet_wrap(~dataset, ncol=3)

```

---

<h4>Let's prove that to ourselves!</h4>

Here's how the data set looks like
```{r echo=TRUE}
datasauRus::datasaurus_dozen %>% glimpse()
datasauRus::datasaurus_dozen %>% select(dataset) %>% table
```

---
Proving that the points in the various datasets (e.g. dino, away) are not identical.

```{r echo=TRUE}
x <- c(1,2,3,4)
x2 <- c(4,3,2,1)
identical(sort(x),sort(x2))

dino <- datasauRus::datasaurus_dozen %>%
  filter(dataset == "dino")
away <- datasauRus::datasaurus_dozen %>%
  filter(dataset == "away")

identical(sort(dino$x), sort(away$x))
```

---

And here's the solution to compute the statistics
```{r echo=TRUE}
datasauRus::datasaurus_dozen %>% group_by(dataset) %>%
  summarise(n = n(), mean_x = mean(x), mean_y = mean(y), 
            sd_x = sd(x), sd_y = sd(y),
            corr = cor(x, y, method = "pearson"))
```

---

---
class: center, middle

<h2> Thanks!</h2>

Slides created via the R package [**xaringan**](https://github.com/yihui/xaringan).

The chakra comes from [remark.js](https://remarkjs.com), [**knitr**](http://yihui.name/knitr), and [R Markdown](https://rmarkdown.rstudio.com).

