---
title: "Data exploration: ggplot2 Basics"
author: "Johannes Breuer<br />Stefan JÃ¼nger<br />Thomas Ebel"
date: "2019-05-16"
location: "GESIS, Mannheim, Germany"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: ["default", "robot-fonts", "../footer-header.css", "../mycss.css"]
    nature:
      highlightStyle: "github"
      highlightLines: true
      countIncrementalSlides: false
---
layout: true

```{r setup, include = FALSE}
if (!require(easypackages)) install.packages("easypackages")
library(easypackages)

packages(
  "knitr", "rmarkdown", "magrittr", "readr", "ggplot2", "hadley/emo",
  prompt = FALSE
)

options(htmltools.dir.version = FALSE)

opts_chunk$set(echo = FALSE, fig.align = "center")
```

<div class="my-footer">
  <div style="float: left;"><span>`r gsub("<br />", " & ", gsub("<br /><br />|<a.+$", "", metadata$author))`</span></div>
  <div style="float: right;"><span>`r metadata$location`, `r metadata$date`</span></div>
  <div style="text-align: center;"><span>`r gsub(".+<br />", " ", metadata$title)`</span></div>
  </div>
  
  
---
# Graphics in `R`

Since its early days `R` has been always pretty nice for creating graphics.

A standard `R` installation doesn't require any additional packages to create graphics.

--


```{r, load_titanic, echo= FALSE}
titanic <- 
  read_csv(
    "../../data/titanic/titanic.csv", 
    col_types = cols()
    ) %>% 
  na.omit()
```

.pull-left[
```{r graphics_hist, eval = FALSE, echo = TRUE}
hist(titanic$Age)
```
]

--

.pull-right[
```{r ref.label = "graphics_hist", echo=FALSE}
```
]

  
---
# What is ggplot2?
`ggplot2` is another R-package to create plots and part of the `tidyverse`.

It uses the "grammar of graphics"

- language for multi-dimensional data

- accordingly, it expects (a) data (frame) as input

- components of the plot are added as layers

--

```{r, eval = FALSE, echo = TRUE}
plot_call +
  layer_1 +
  layer_2 +
  ... +
  layer_n
```


---
# Plot examples 

.pull-left[
```{r}
knitr::include_graphics("./143_radar_chart_multi_indiv_2.png")
```
]

.pull-right[
```{r}
knitr::include_graphics("./21_ggplot2_ddensity_plot.png")
```
]


<small><small>Source:</small></small>

---
# Plot examples 

.pull-left[
```{r}
knitr::include_graphics("./51_scatterplot_linear_model_with_CI_ggplot2.png")
```
]

.pull-right[
```{r}
knitr::include_graphics("./328_Hexbin_map_USA_4.png")
```
]

<small><small>Source:</small></small>

---
# Histograms as in standard `R`

```{r ggplot_histogram, out.width = "65%"}
ggplot(titanic, aes(x = Age)) + 
  geom_histogram(binwidth = 5)
```

---
# Components of a plot
According to Wickham (2010, 8)* a layered plot consists of the following components:

--
- data and aesthetic mappings,

--
- geometric objects,

--
- scales,

--
- and facet specification

<span class="footnote">
<small><small><span class="red bold">*</span> http://dx.doi.org/10.1198/jcgs.2009.07098</small></small>
</span>

--
```{r, eval = FALSE, echo = TRUE}
plot_call +
  data +
  aesthetics +
  geometries +
  scales +
  facets
```


---
# Data requirements
You can use one single data frame to create a plot in `ggplot2`.
- everything's on the plot is just data
- creates a nice and smooth workflow from data wrangling to the final presentation of the results


```{r data_science_pic, out.width = "70%"}
knitr::include_graphics("./pics/data-science_man.png")
```

<small><small>Source:</small></small>

--

But this makes it difficult to add extra features to your plot.
  - There are ways of doing it anyway as we will see later
  - Yet, it requires thinking about what to plot

---
# Why the long data format?


ggplot2 requires data to be in the long data format

- in some scientific disciplines this format is only used for specialized analyses 
- e.g., time series analysis


.pull-left[
We may want to get used to it as this format has some benefits

- every element we aim to plot is an observation
- no thinking required how a specific variable relates to an observation
- most importantly, the long format is more parsimonious
- it requires less memory and less disk space
]


.pull-right[
```{r long_pic, out.width = "50%"}
knitr::include_graphics("./pics/long.png")
```
]

<small><small>Source:</small></small>
  
  
---
# Creating your own plot

Theory on plots is boring

- creating plots is all about practice
- ...and stealing code from others


.column-left-half[
```{r, eval = FALSE, echo = TRUE}
please +
  no +
  more +
  pseudo +
  code +
  man
```
]

.column-right-half[
Three components are important:

- Plot initation
- data input
- aesthetics definition
- so called `geoms`
]


---
# Plot initation

.pull-left[
`ggplot()` is the most basic command to create a plot:

```{r ggplot_basic, eval = FALSE, echo = TRUE}
ggplot()
```
]

--

.pull-right[
```{r ref.label = "ggplot_basic", echo=FALSE}
```
]

--

**But it doesn't show anything...**


---
# Data input

.pull-left[
As we've already learned `ggplot()` expects data as input

```{r ggplot_data, eval = FALSE, echo = TRUE}
titanic <- 
  read_csv(
    "../../data/titanic/titanic.csv", 
    col_types = cols()
    ) %>% 
  na.omit()

ggplot(data = titanic)
```
]

--

.pull-right[
```{r ref.label = "ggplot_data", echo=FALSE}
```
]

--

**Still nothing there...**


---
# Aesthetics! 

.pull-left[
`ggplot` requires information about the variables to plot

```{r ggplot_aes, eval = FALSE, echo = TRUE}
ggplot(data = titanic) +
  aes(x = Age, y = Fare) #<<
```
]

--

.pull-right[
```{r ref.label = "ggplot_aes", echo=FALSE}
```
]

--

**That's a little bit better, right?**


---
# `geoms`!

.pull-left[
Finally, `ggplot` needs information *how* to plot the variables

```{r ggplot_geom, eval = FALSE, echo = TRUE}
ggplot(data = titanic) +
  aes(x = Age, y = Fare) +
  geom_point() #<<
```
]

--

.pull-right[
```{r ref.label = "ggplot_geom", echo=FALSE}
```
]

--

**A scatter plot!**

---
# Add a line

.pull-left[
We can also add more than one `geom`

```{r ggplot_line, eval = FALSE, echo = TRUE}
ggplot(data = titanic) +
  aes(x = Age, y = Fare) +
  geom_point() +
  geom_smooth() #<<
```
]

--

.pull-right[
```{r ref.label = "ggplot_line", echo=FALSE}
```
]

--

**A regression line!**

---
# Going further: add group asthetics

.pull-left[
`ggplot()` is the most basic command to create a plot:

```{r ggplot_group, eval = FALSE, echo = TRUE}
ggplot(
  data = titanic,
  aes(
    x = Age, 
    y = Fare, 
    color = Sex #<<
    )
  ) +
  geom_point()
```
]

--

.pull-right[
```{r ref.label = "ggplot_group", echo=FALSE}
```
]

---
# Manipulate group asthetics

.pull-left[
`ggplot()` is the most basic command to create a plot:

```{r ggplot_group_man, eval = FALSE, echo = TRUE}
ggplot(
  data = titanic,
  aes(
    x = Age, 
    y = Fare, 
    color = Sex
    )
  ) +
  geom_point() +
  scale_color_brewer( #<<
    palette = "Accent" #<<
    ) #<<
```
]

--

.pull-right[
```{r ref.label = "ggplot_group_man", echo=FALSE}
```
]


---
# A note on manipulations

.pull-left[
Working with combined aesthetics and different data inputs can become cumbersome.

Particularly, plotting similar aesthetics which interfer the automatic procedures can create conflicts.

My 'favorite' ones are:

- Multiple legends
- and multiple color scales for similar `geoms` 
- there's more!
]

.pull-right[
```{r der_schrei}
knitr::include_graphics("./pics/800px-The_Scream.jpg")
```
]

.right[
<small><small>Source: https://de.wikipedia.org/wiki/Der_Schrei#/media/File:The_Scream.jpg</small></small>
]


---
# Shortcuts

`ggplot` is powerful

- yet, it's complicated
- it has a steep learning curve


---
# `qplot()` or `quickplot()`

.pull-left[
```{r qplot_example, eval = FALSE, echo = TRUE}
qplot(
  x = titanic$Age, 
  y = titanic$Fare,
  geom = "point"
  )
```
]

--

.pull-right[
```{r ref.label = "qplot_example", echo=FALSE}
```
]


---
# `qplot()` or `quickplot()`

.pull-left[
```{r qplot_example_2, eval = FALSE, echo = TRUE}
qplot(
  x = titanic$Age, 
  y = titanic$Fare,
  geom = c("point", "smooth") #<<
  )
```
]

--

.pull-right[
```{r ref.label = "qplot_example_2", echo=FALSE}
```
]

---

class: center, middle

# [Exercise](https://jobreu.github.io/tidyverse-workshop-gesis-2019/exercises/B4_ggplot2Basics_exercises_question.html) time `r ji("weight_lifting_woman")``r ji("muscle")``r ji("running_man")``r ji("biking_man")`

## [Solutions](https://jobreu.github.io/tidyverse-workshop-gesis-2019/solutions/B4_ggplot2Basics_exercises_solution.html)
  
  
  
  
  
  
  